import{r as H,$ as i,A as J,F as L,B as K}from"./auth-CSSp3u3s.js";document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("cally-widget"),r=document.getElementById("data-display"),a=document.getElementById("data-input"),d=document.getElementById("btn-limpar");e&&(e.addEventListener("change",v=>{const w=v.target.value;a.value=w;const[I,C,t]=w.split("-");r.textContent=`${t}/${C}/${I}`,r.classList.remove("text-zinc-400"),r.classList.add("text-zinc-950"),d.classList.remove("hidden"),a.dispatchEvent(new Event("change")),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),d.addEventListener("mousedown",v=>{v.preventDefault(),v.stopPropagation()}),d.addEventListener("click",v=>{v.stopPropagation(),v.preventDefault(),e.value="",a.value="",r.textContent="Selecionar data...",r.classList.remove("text-zinc-950"),r.classList.add("text-zinc-400"),d.classList.add("hidden"),a.dispatchEvent(new Event("change"))}))});var z={exports:{}},U;function Q(){return U||(U=1,(function(e,r){(function(a,d,v){typeof Meteor>"u"?e.exports=a(H()):a(d||v)})(function(a){var d=function(t,c,f){var n={invalid:[],getCaret:function(){try{var o,l=0,s=t.get(0),m=document.selection,u=s.selectionStart;return m&&navigator.appVersion.indexOf("MSIE 10")===-1?(o=m.createRange(),o.moveStart("character",-n.val().length),l=o.text.length):(u||u==="0")&&(l=u),l}catch{}},setCaret:function(o){try{if(t.is(":focus")){var l,s=t.get(0);s.setSelectionRange?s.setSelectionRange(o,o):(l=s.createTextRange(),l.collapse(!0),l.moveEnd("character",o),l.moveStart("character",o),l.select())}}catch{}},events:function(){t.on("keydown.mask",function(o){t.data("mask-keycode",o.keyCode||o.which),t.data("mask-previus-value",t.val()),t.data("mask-previus-caret-pos",n.getCaret()),n.maskDigitPosMapOld=n.maskDigitPosMap}).on(a.jMaskGlobals.useInput?"input.mask":"keyup.mask",n.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){t.keydown().keyup()},100)}).on("change.mask",function(){t.data("changed",!0)}).on("blur.mask",function(){A!==n.val()&&!t.data("changed")&&t.trigger("change"),t.data("changed",!1)}).on("blur.mask",function(){A=n.val()}).on("focus.mask",function(o){f.selectOnFocus===!0&&a(o.target).select()}).on("focusout.mask",function(){f.clearIfNotMatch&&!D.test(n.val())&&n.val("")})},getRegexMask:function(){for(var o=[],l,s,m,u,k,h,M=0;M<c.length;M++)l=p.translation[c.charAt(M)],l?(s=l.pattern.toString().replace(/.{1}$|^.{1}/g,""),m=l.optional,u=l.recursive,u?(o.push(c.charAt(M)),k={digit:c.charAt(M),pattern:s}):o.push(!m&&!u?s:s+"?")):o.push(c.charAt(M).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return h=o.join(""),k&&(h=h.replace(new RegExp("("+k.digit+"(.*"+k.digit+")?)"),"($1)?").replace(new RegExp(k.digit,"g"),k.pattern)),new RegExp(h)},destroyEvents:function(){t.off(["input","keydown","keyup","paste","drop","blur","focusout",""].join(".mask "))},val:function(o){var l=t.is("input"),s=l?"val":"text",m;return arguments.length>0?(t[s]()!==o&&t[s](o),m=t):m=t[s](),m},calculateCaretPosition:function(o){var l=n.getMasked(),s=n.getCaret();if(o!==l){var m=t.data("mask-previus-caret-pos")||0,u=l.length,k=o.length,h=0,M=0,y=0,x=0,g=0;for(g=s;g<u&&n.maskDigitPosMap[g];g++)M++;for(g=s-1;g>=0&&n.maskDigitPosMap[g];g--)h++;for(g=s-1;g>=0;g--)n.maskDigitPosMap[g]&&y++;for(g=m-1;g>=0;g--)n.maskDigitPosMapOld[g]&&x++;if(s>k)s=u*10;else if(m>=s&&m!==k){if(!n.maskDigitPosMapOld[s]){var j=s;s-=x-y,s-=h,n.maskDigitPosMap[s]&&(s=j)}}else s>m&&(s+=y-x,s+=M)}return s},behaviour:function(o){o=o||window.event,n.invalid=[];var l=t.data("mask-keycode");if(a.inArray(l,p.byPassKeys)===-1){var s=n.getMasked(),m=n.getCaret(),u=t.data("mask-previus-value")||"";return setTimeout(function(){n.setCaret(n.calculateCaretPosition(u))},a.jMaskGlobals.keyStrokeCompensation),n.val(s),n.setCaret(m),n.callbacks(o)}},getMasked:function(o,l){var s=[],m=l===void 0?n.val():l+"",u=0,k=c.length,h=0,M=m.length,y=1,x="push",g=-1,j=0,F=[],P,O;f.reverse?(x="unshift",y=-1,P=0,u=k-1,h=M-1,O=function(){return u>-1&&h>-1}):(P=k-1,O=function(){return u<k&&h<M});for(var V;O();){var S=c.charAt(u),T=m.charAt(h),E=p.translation[S];E?(T.match(E.pattern)?(s[x](T),E.recursive&&(g===-1?g=u:u===P&&u!==g&&(u=g-y),P===g&&(u-=y)),u+=y):T===V?(j--,V=void 0):E.optional?(u+=y,h-=y):E.fallback?(s[x](E.fallback),u+=y,h-=y):n.invalid.push({p:h,v:T,e:E.pattern}),h+=y):(o||s[x](S),T===S?(F.push(h),h+=y):(V=S,F.push(h+j),j++),u+=y)}var W=c.charAt(P);k===M+1&&!p.translation[W]&&s.push(W);var B=s.join("");return n.mapMaskdigitPositions(B,F,M),B},mapMaskdigitPositions:function(o,l,s){var m=f.reverse?o.length-s:0;n.maskDigitPosMap={};for(var u=0;u<l.length;u++)n.maskDigitPosMap[l[u]+m]=1},callbacks:function(o){var l=n.val(),s=l!==A,m=[l,o,t,f],u=function(k,h,M){typeof f[k]=="function"&&h&&f[k].apply(this,M)};u("onChange",s===!0,m),u("onKeyPress",s===!0,m),u("onComplete",l.length===c.length,m),u("onInvalid",n.invalid.length>0,[l,o,t,n.invalid,f])}};t=a(t);var p=this,A=n.val(),D;c=typeof c=="function"?c(n.val(),void 0,t,f):c,p.mask=c,p.options=f,p.remove=function(){var o=n.getCaret();return p.options.placeholder&&t.removeAttr("placeholder"),t.data("mask-maxlength")&&t.removeAttr("maxlength"),n.destroyEvents(),n.val(p.getCleanVal()),n.setCaret(o),t},p.getCleanVal=function(){return n.getMasked(!0)},p.getMaskedVal=function(o){return n.getMasked(!1,o)},p.init=function(o){if(o=o||!1,f=f||{},p.clearIfNotMatch=a.jMaskGlobals.clearIfNotMatch,p.byPassKeys=a.jMaskGlobals.byPassKeys,p.translation=a.extend({},a.jMaskGlobals.translation,f.translation),p=a.extend(!0,{},p,f),D=n.getRegexMask(),o)n.events(),n.val(n.getMasked());else{f.placeholder&&t.attr("placeholder",f.placeholder),t.data("mask")&&t.attr("autocomplete","off");for(var l=0,s=!0;l<c.length;l++){var m=p.translation[c.charAt(l)];if(m&&m.recursive){s=!1;break}}s&&t.attr("maxlength",c.length).data("mask-maxlength",!0),n.destroyEvents(),n.events();var u=n.getCaret();n.val(n.getMasked()),n.setCaret(u)}},p.init(!t.is("input"))};a.maskWatchers={};var v=function(){var t=a(this),c={},f="data-mask-",n=t.attr("data-mask");if(t.attr(f+"reverse")&&(c.reverse=!0),t.attr(f+"clearifnotmatch")&&(c.clearIfNotMatch=!0),t.attr(f+"selectonfocus")==="true"&&(c.selectOnFocus=!0),w(t,n,c))return t.data("mask",new d(this,n,c))},w=function(t,c,f){f=f||{};var n=a(t).data("mask"),p=JSON.stringify,A=a(t).val()||a(t).text();try{return typeof c=="function"&&(c=c(A)),typeof n!="object"||p(n.options)!==p(f)||n.mask!==c}catch{}},I=function(t){var c=document.createElement("div"),f;return t="on"+t,f=t in c,f||(c.setAttribute(t,"return;"),f=typeof c[t]=="function"),c=null,f};a.fn.mask=function(t,c){c=c||{};var f=this.selector,n=a.jMaskGlobals,p=n.watchInterval,A=c.watchInputs||n.watchInputs,D=function(){if(w(this,t,c))return a(this).data("mask",new d(this,t,c))};return a(this).each(D),f&&f!==""&&A&&(clearInterval(a.maskWatchers[f]),a.maskWatchers[f]=setInterval(function(){a(document).find(f).each(D)},p)),this},a.fn.masked=function(t){return this.data("mask").getMaskedVal(t)},a.fn.unmask=function(){return clearInterval(a.maskWatchers[this.selector]),delete a.maskWatchers[this.selector],this.each(function(){var t=a(this).data("mask");t&&t.remove().removeData("mask")})},a.fn.cleanVal=function(){return this.data("mask").getCleanVal()},a.applyDataMask=function(t){t=t||a.jMaskGlobals.maskElements;var c=t instanceof a?t:a(t);c.filter(a.jMaskGlobals.dataMaskAttr).each(v)};var C={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,keyStrokeCompensation:10,useInput:!/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent)&&I("input"),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};a.jMaskGlobals=a.jMaskGlobals||{},C=a.jMaskGlobals=a.extend(!0,{},C,a.jMaskGlobals),C.dataMask&&a.applyDataMask(),setInterval(function(){a.jMaskGlobals.watchDataMask&&a.applyDataMask()},C.watchInterval)},window.jQuery,window.Zepto)})(z)),z.exports}Q();const X="http://localhost:3001",q={descricao:/^[a-zA-ZÀ-ÿ0-9\s.,!?()-]+$/,valorMonetario:/^\d{1,3}(\.\d{3})*(,\d{2})?$/,dataISO:/^\d{4}-\d{2}-\d{2}$/};let b=0;i(document).ready(function(){const e=J.verificarAutenticacao(!0);if(!e)return;aa(),ea(),$(),R(),i("#descricao").on("input",R),i("#data-input").on("change",R),i("#form-transacao").on("submit",function(a){a.preventDefault(),oa(e.id)});const r=e.nome.split(" ").map(a=>a[0]).slice(0,2).join("").toUpperCase();i(".avatar-inicial").text(r),i("#usuario-email").text(e.email),i("#btn-logout").on("click",function(a){a.preventDefault(),i("main").addClass("animate-exit"),setTimeout(function(){J.logout()},300)})});function Y(e,r){const a=e.attr("id");let d=i(`#${a}-erro`);d.length||(d=i(`<span id="${a}-erro" class="text-xs text-red-500 mt-1"></span>`),e.closest(".form-control").append(d)),d.text(r).removeClass("hidden"),e.addClass("input-error").removeClass("input-success")}function N(e){const r=e.attr("id");i(`#${r}-erro`).addClass("hidden"),e.removeClass("input-error")}function G(e){N(e),e.addClass("input-success")}function $(){i("#descricao").on("blur",function(){const e=i(this).val().trim(),r=i(this);if(e.length>0){const a=Z(e);a.valido?G(r):Y(r,a.mensagem)}}),i("#descricao").on("input",function(){N(i(this))}),i("#valor").on("blur",function(){const e=i(this).val(),r=i(this);if(e.length>0){const a=_(e);a.valido?G(r):Y(r,a.mensagem)}}),i("#categoria").on("change",function(){const e=i(this).val(),r=i(this);e&&G(r)})}function R(){const e=i("#descricao").val().trim(),r=i("#data-input").val(),a=e.length>=3&&b>0&&r.length>0;i("#btn-submit").prop("disabled",!a)}function aa(){const e=i("#valor");e.val(r(b));function r(d){return(d/100).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}e.on("keydown",function(d){const v=d.key;return["Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(v)?!0:(d.preventDefault(),v==="Backspace"?(b=Math.floor(b/10),e.val(r(b)),a(),!1):v==="Delete"?(b=0,e.val(r(b)),a(),!1):(/^[0-9]$/.test(v)&&(b>9999999999||(b=b*10+parseInt(v),e.val(r(b)),a())),!1))}),e.on("paste",function(d){d.preventDefault();const w=(d.originalEvent.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"");w&&(b=parseInt(w)||0,b>99999999999&&(b=99999999999),e.val(r(b)),a())});function a(){N(e),b>0?e.removeClass("input-error").addClass("input-success"):e.removeClass("input-success").removeClass("input-error"),R()}e.on("focus",function(){const d=i(this).val().length;this.setSelectionRange(d,d)}),e.data("getCentavos",function(){return b})}function ea(){const e=new Date,r=e.toLocaleDateString("pt-BR");i("#data-display").text(r).removeClass("text-zinc-400").addClass("text-amber-900"),i("#data-input").val(e.toISOString().split("T")[0]),i("#btn-limpar").removeClass("hidden")}function ta(e){return e&&parseFloat(e.replace(/\./g,"").replace(",","."))||0}function Z(e){return!e||e.trim()===""?{valido:!1,mensagem:"A descrição é obrigatória"}:(e=e.trim(),e.length<3?{valido:!1,mensagem:"A descrição deve ter pelo menos 3 caracteres"}:e.length>100?{valido:!1,mensagem:"A descrição deve ter no máximo 100 caracteres"}:q.descricao.test(e)?{valido:!0,mensagem:""}:{valido:!1,mensagem:"A descrição contém caracteres inválidos"})}function _(e){if(!e||e.trim()==="")return{valido:!1,mensagem:"O valor é obrigatório",valor:0};const r=ta(e);return isNaN(r)?{valido:!1,mensagem:"Valor inválido",valor:0}:r<=0?{valido:!1,mensagem:"O valor deve ser maior que zero",valor:0}:r>99999999999e-2?{valido:!1,mensagem:"O valor máximo é R$ 999.999.999,99",valor:0}:e.includes(",")&&!q.valorMonetario.test(e)?{valido:!1,mensagem:"Formato de valor inválido",valor:0}:{valido:!0,mensagem:"",valor:r}}function na(e){if(!e||e.trim()==="")return{valido:!1,mensagem:"Selecione uma data para a transação"};if(!q.dataISO.test(e))return{valido:!1,mensagem:"Formato de data inválido"};const r=new Date(e);if(isNaN(r.getTime()))return{valido:!1,mensagem:"Data inválida"};const a=new Date;if(a.setFullYear(a.getFullYear()+1),r>a)return{valido:!1,mensagem:"A data não pode ser superior a 1 ano no futuro"};const d=new Date;return d.setFullYear(d.getFullYear()-10),r<d?{valido:!1,mensagem:"A data não pode ser superior a 10 anos no passado"}:{valido:!0,mensagem:""}}function ra(e){if(!e)return{valido:!1,mensagem:"Selecione o tipo da transação"};const r=e.toLowerCase();return r!=="receita"&&r!=="despesa"?{valido:!1,mensagem:"Tipo de transação inválido"}:{valido:!0,mensagem:""}}function sa(){const e=i("#descricao").val().trim(),r=i("#valor").val(),a=i("#data-input").val(),d=i('input[name="tipo"]:checked').attr("aria-label"),v=i("#categoria").val()||"Outros";i(".input, .select").removeClass("input-error").removeClass("input-success"),L.limpar("mensagem-feedback");const w=Z(e);if(!w.valido)return{valido:!1,mensagem:w.mensagem,campo:"#descricao"};const I=_(r);if(!I.valido)return{valido:!1,mensagem:I.mensagem,campo:"#valor"};const C=na(a);if(!C.valido)return{valido:!1,mensagem:C.mensagem,campo:null};const t=ra(d);return t.valido?{valido:!0,mensagem:"",dados:{descricao:e,valor:I.valor,data:a,tipo:d.toLowerCase(),categoria:v}}:{valido:!1,mensagem:t.mensagem,campo:null}}function oa(e){const r=sa();if(!r.valido){L.erro("mensagem-feedback",r.mensagem),r.campo&&i(r.campo).addClass("input-error").focus(),i("#form-transacao").addClass("animate-shake"),setTimeout(function(){i("#form-transacao").removeClass("animate-shake")},500);return}const a=i('#form-transacao button[type="submit"]');K.loading(a,"Salvar transação");const d={usuarioId:e,descricao:r.dados.descricao,categoria:r.dados.categoria,valor:r.dados.valor,tipo:r.dados.tipo,data:r.dados.data};i.ajax({url:`${X}/transacoes`,method:"POST",contentType:"application/json",data:JSON.stringify(d),dataType:"json"}).then(function(){const v=d.tipo==="receita"?"Receita":"Despesa";L.sucesso("mensagem-feedback",`${v} adicionada com sucesso!`),setTimeout(function(){i("main").addClass("animate-exit"),setTimeout(function(){window.location.href="./todas-transacoes.html"},300)},1e3)}).catch(function(v){console.error("Erro ao salvar transação:",v);let w="Erro ao salvar transação. Tente novamente.";v.statusText==="error"&&(w="Erro de conexão. Verifique se o servidor está rodando."),L.erro("mensagem-feedback",w),K.restaurar(a)})}
