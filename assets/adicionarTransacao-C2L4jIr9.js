import{$ as n,A as g}from"./auth-Dh7lbV3Z.js";import{F as l,B as h}from"./button-Dnti6uPe.js";function E(a){const[e,t,o]=a.split("-");return`${o}/${t}/${e}`}function C(a,e,t){t?(a.classList.remove("text-zinc-400"),a.classList.add("text-zinc-950"),e.classList.remove("hidden")):(a.textContent="Selecionar data...",a.classList.remove("text-zinc-950"),a.classList.add("text-zinc-400"),e.classList.add("hidden"))}function L(a,e){const{displaySpan:t,hiddenInput:o,btnLimpar:r}=e,s=a.target.value;o.value=s,t.textContent=E(s),C(t,r,!0),o.dispatchEvent(new Event("change")),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}function w(a){a.preventDefault(),a.stopPropagation()}function T(a,e){const{callyWidget:t,displaySpan:o,hiddenInput:r,btnLimpar:s}=e;a.stopPropagation(),a.preventDefault(),t.value="",r.value="",C(o,s,!1),r.dispatchEvent(new Event("change"))}function y(){const a=document.getElementById("cally-widget"),e=document.getElementById("data-display"),t=document.getElementById("data-input"),o=document.getElementById("btn-limpar");return a?{callyWidget:a,displaySpan:e,hiddenInput:t,btnLimpar:o}:null}function A(a){const{callyWidget:e,btnLimpar:t}=a;e.addEventListener("change",o=>{L(o,a)}),t.addEventListener("mousedown",w),t.addEventListener("click",o=>{T(o,a)})}function I(){const a=y();a&&A(a)}document.addEventListener("DOMContentLoaded",I);const k="http://localhost:3001",m={descricao:/^[a-zA-ZÀ-ÿ0-9\s.,!?()-]+$/,valorMonetario:/^\d{1,3}(\.\d{3})*(,\d{2})?$/,dataISO:/^\d{4}-\d{2}-\d{2}$/};let i=0;n(document).ready(function(){const a=g.verificarAutenticacao(!0);if(!a)return;z(),F(),$(),c(),n("#descricao").on("input",c),n("#data-input").on("change",c),n("#form-transacao").on("submit",function(t){t.preventDefault(),M(a.id)});const e=a.nome.split(" ").map(t=>t[0]).slice(0,2).join("").toUpperCase();n(".avatar-inicial").text(e),n("#usuario-email").text(a.email),n("#btn-logout").on("click",function(t){t.preventDefault(),n("main").addClass("animate-exit"),setTimeout(function(){g.logout()},300)})});function b(a,e){const t=a.attr("id");let o=n(`#${t}-erro`);o.length||(o=n(`<span id="${t}-erro" class="text-xs text-red-500 mt-1"></span>`),a.closest(".form-control").append(o)),o.text(e).removeClass("hidden"),a.addClass("input-error").removeClass("input-success")}function f(a){const e=a.attr("id");n(`#${e}-erro`).addClass("hidden"),a.removeClass("input-error")}function u(a){f(a),a.addClass("input-success")}function $(){n("#descricao").on("blur",function(){const a=n(this).val().trim(),e=n(this);if(a.length>0){const t=x(a);t.valido?u(e):b(e,t.mensagem)}}),n("#descricao").on("input",function(){f(n(this))}),n("#valor").on("blur",function(){const a=n(this).val(),e=n(this);if(a.length>0){const t=D(a);t.valido?u(e):b(e,t.mensagem)}}),n("#categoria").on("change",function(){const a=n(this).val(),e=n(this);a&&u(e)})}function c(){const a=n("#descricao").val().trim(),e=n("#data-input").val(),t=a.length>=3&&i>0&&e.length>0;n("#btn-submit").prop("disabled",!t)}function z(){const a=n("#valor");a.val(e(i));function e(o){return(o/100).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}a.on("keydown",function(o){const r=o.key;return["Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(r)?!0:(o.preventDefault(),r==="Backspace"?(i=Math.floor(i/10),a.val(e(i)),t(),!1):r==="Delete"?(i=0,a.val(e(i)),t(),!1):(/^[0-9]$/.test(r)&&(i>9999999999||(i=i*10+parseInt(r),a.val(e(i)),t())),!1))}),a.on("paste",function(o){o.preventDefault();const s=(o.originalEvent.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"");s&&(i=parseInt(s)||0,i>99999999999&&(i=99999999999),a.val(e(i)),t())});function t(){f(a),i>0?a.removeClass("input-error").addClass("input-success"):a.removeClass("input-success").removeClass("input-error"),c()}a.on("focus",function(){const o=n(this).val().length;this.setSelectionRange(o,o)}),a.data("getCentavos",function(){return i})}function F(){const a=new Date,e=a.toLocaleDateString("pt-BR");n("#data-display").text(e).removeClass("text-zinc-400").addClass("text-amber-900"),n("#data-input").val(a.toISOString().split("T")[0]),n("#btn-limpar").removeClass("hidden")}function O(a){return a&&parseFloat(a.replace(/\./g,"").replace(",","."))||0}function x(a){return!a||a.trim()===""?{valido:!1,mensagem:"A descrição é obrigatória"}:(a=a.trim(),a.length<3?{valido:!1,mensagem:"A descrição deve ter pelo menos 3 caracteres"}:a.length>100?{valido:!1,mensagem:"A descrição deve ter no máximo 100 caracteres"}:m.descricao.test(a)?{valido:!0,mensagem:""}:{valido:!1,mensagem:"A descrição contém caracteres inválidos"})}function D(a){if(!a||a.trim()==="")return{valido:!1,mensagem:"O valor é obrigatório",valor:0};const e=O(a);return isNaN(e)?{valido:!1,mensagem:"Valor inválido",valor:0}:e<=0?{valido:!1,mensagem:"O valor deve ser maior que zero",valor:0}:e>99999999999e-2?{valido:!1,mensagem:"O valor máximo é R$ 999.999.999,99",valor:0}:a.includes(",")&&!m.valorMonetario.test(a)?{valido:!1,mensagem:"Formato de valor inválido",valor:0}:{valido:!0,mensagem:"",valor:e}}function S(a){if(!a||a.trim()==="")return{valido:!1,mensagem:"Selecione uma data para a transação"};if(!m.dataISO.test(a))return{valido:!1,mensagem:"Formato de data inválido"};const e=new Date(a);if(isNaN(e.getTime()))return{valido:!1,mensagem:"Data inválida"};const t=new Date;if(t.setFullYear(t.getFullYear()+1),e>t)return{valido:!1,mensagem:"A data não pode ser superior a 1 ano no futuro"};const o=new Date;return o.setFullYear(o.getFullYear()-10),e<o?{valido:!1,mensagem:"A data não pode ser superior a 10 anos no passado"}:{valido:!0,mensagem:""}}function V(a){if(!a)return{valido:!1,mensagem:"Selecione o tipo da transação"};const e=a.toLowerCase();return e!=="receita"&&e!=="despesa"?{valido:!1,mensagem:"Tipo de transação inválido"}:{valido:!0,mensagem:""}}function B(){const a=n("#descricao").val().trim(),e=n("#valor").val(),t=n("#data-input").val(),o=n('input[name="tipo"]:checked').attr("aria-label"),r=n("#categoria").val()||"Outros";n(".input, .select").removeClass("input-error").removeClass("input-success"),l.limpar("mensagem-feedback");const s=x(a);if(!s.valido)return{valido:!1,mensagem:s.mensagem,campo:"#descricao"};const d=D(e);if(!d.valido)return{valido:!1,mensagem:d.mensagem,campo:"#valor"};const v=S(t);if(!v.valido)return{valido:!1,mensagem:v.mensagem,campo:null};const p=V(o);return p.valido?{valido:!0,mensagem:"",dados:{descricao:a,valor:d.valor,data:t,tipo:o.toLowerCase(),categoria:r}}:{valido:!1,mensagem:p.mensagem,campo:null}}function M(a){const e=B();if(!e.valido){l.erro("mensagem-feedback",e.mensagem),e.campo&&n(e.campo).addClass("input-error").focus(),n("#form-transacao").addClass("animate-shake"),setTimeout(function(){n("#form-transacao").removeClass("animate-shake")},500);return}const t=n('#form-transacao button[type="submit"]');h.loading(t,"Salvar transação");const o={usuarioId:a,descricao:e.dados.descricao,categoria:e.dados.categoria,valor:e.dados.valor,tipo:e.dados.tipo,data:e.dados.data};n.ajax({url:`${k}/transacoes`,method:"POST",contentType:"application/json",data:JSON.stringify(o),dataType:"json"}).then(function(){const r=o.tipo==="receita"?"Receita":"Despesa";l.sucesso("mensagem-feedback",`${r} adicionada com sucesso!`),setTimeout(function(){n("main").addClass("animate-exit"),setTimeout(function(){window.location.href="./todas-transacoes.html"},300)},1e3)}).catch(function(r){console.error("Erro ao salvar transação:",r);let s="Erro ao salvar transação. Tente novamente.";r.statusText==="error"&&(s="Erro de conexão. Verifique se o servidor está rodando."),l.erro("mensagem-feedback",s),h.restaurar(t)})}
