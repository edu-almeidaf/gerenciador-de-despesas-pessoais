import{$ as n,A as C}from"./auth-Dh7lbV3Z.js";import{I as l,F as m,B as h}from"./input-C-Bf7OHr.js";import{U as b}from"./usuario-BcV4MTD3.js";function w(a){const[e,t,o]=a.split("-");return`${o}/${t}/${e}`}function E(a,e,t){t?(a.classList.remove("text-zinc-400"),a.classList.add("text-zinc-950"),e.classList.remove("hidden")):(a.textContent="Selecionar data...",a.classList.remove("text-zinc-950"),a.classList.add("text-zinc-400"),e.classList.add("hidden"))}function x(a,e){const{displaySpan:t,hiddenInput:o,btnLimpar:i}=e,s=a.target.value;o.value=s,t.textContent=w(s),E(t,i,!0),o.dispatchEvent(new Event("change")),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}function y(a){a.preventDefault(),a.stopPropagation()}function T(a,e){const{callyWidget:t,displaySpan:o,hiddenInput:i,btnLimpar:s}=e;a.stopPropagation(),a.preventDefault(),t.value="",i.value="",E(o,s,!1),i.dispatchEvent(new Event("change"))}function A(){const a=document.getElementById("cally-widget"),e=document.getElementById("data-display"),t=document.getElementById("data-input"),o=document.getElementById("btn-limpar");return a?{callyWidget:a,displaySpan:e,hiddenInput:t,btnLimpar:o}:null}function I(a){const{callyWidget:e,btnLimpar:t}=a;e.addEventListener("change",o=>{x(o,a)}),t.addEventListener("mousedown",y),t.addEventListener("click",o=>{T(o,a)})}function k(){const a=A();a&&I(a)}document.addEventListener("DOMContentLoaded",k);const S="http://localhost:3001",v={descricao:/^[a-zA-ZÀ-ÿ0-9\s.,!?()-]+$/,valorMonetario:/^\d{1,3}(\.\d{3})*(,\d{2})?$/,dataISO:/^\d{4}-\d{2}-\d{2}$/};let r=0;function $(a){return a&&parseFloat(a.replace(/\./g,"").replace(",","."))||0}function c(a){return(a/100).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}function D(a){return!a||a.trim()===""?{valido:!1,mensagem:"A descrição é obrigatória"}:(a=a.trim(),a.length<3?{valido:!1,mensagem:"A descrição deve ter pelo menos 3 caracteres"}:a.length>100?{valido:!1,mensagem:"A descrição deve ter no máximo 100 caracteres"}:v.descricao.test(a)?{valido:!0,mensagem:""}:{valido:!1,mensagem:"A descrição contém caracteres inválidos"})}function L(a){if(!a||a.trim()==="")return{valido:!1,mensagem:"O valor é obrigatório",valor:0};const e=$(a);return isNaN(e)?{valido:!1,mensagem:"Valor inválido",valor:0}:e<=0?{valido:!1,mensagem:"O valor deve ser maior que zero",valor:0}:e>99999999999e-2?{valido:!1,mensagem:"O valor máximo é R$ 999.999.999,99",valor:0}:a.includes(",")&&!v.valorMonetario.test(a)?{valido:!1,mensagem:"Formato de valor inválido",valor:0}:{valido:!0,mensagem:"",valor:e}}function F(a){if(!a||a.trim()==="")return{valido:!1,mensagem:"Selecione uma data para a transação"};if(!v.dataISO.test(a))return{valido:!1,mensagem:"Formato de data inválido"};const e=new Date(a);if(isNaN(e.getTime()))return{valido:!1,mensagem:"Data inválida"};const t=new Date;if(t.setFullYear(t.getFullYear()+1),e>t)return{valido:!1,mensagem:"A data não pode ser superior a 1 ano no futuro"};const o=new Date;return o.setFullYear(o.getFullYear()-10),e<o?{valido:!1,mensagem:"A data não pode ser superior a 10 anos no passado"}:{valido:!0,mensagem:""}}function V(a){if(!a)return{valido:!1,mensagem:"Selecione o tipo da transação"};const e=a.toLowerCase();return e!=="receita"&&e!=="despesa"?{valido:!1,mensagem:"Tipo de transação inválido"}:{valido:!0,mensagem:""}}function z(){const a=n("#descricao").val().trim(),e=n("#valor").val(),t=n("#data-input").val(),o=n('input[name="tipo"]:checked').attr("aria-label"),i=n("#categoria").val()||"Outros";n(".input, .select").removeClass("input-error").removeClass("input-success"),m.limpar("mensagem-feedback");const s=D(a);if(!s.valido)return{valido:!1,mensagem:s.mensagem,campo:"#descricao"};const f=L(e);if(!f.valido)return{valido:!1,mensagem:f.mensagem,campo:"#valor"};const p=F(t);if(!p.valido)return{valido:!1,mensagem:p.mensagem,campo:null};const g=V(o);return g.valido?{valido:!0,mensagem:"",dados:{descricao:a,valor:f.valor,data:t,tipo:o.toLowerCase(),categoria:i}}:{valido:!1,mensagem:g.mensagem,campo:null}}function u(){const a=n("#descricao").val().trim(),e=n("#data-input").val(),t=a.length>=3&&r>0&&e.length>0;n("#btn-submit").prop("disabled",!t)}function d(a){l.limparErro(a),r>0?a.removeClass("input-error").addClass("input-success"):a.removeClass("input-success").removeClass("input-error"),u()}function O(){const a=n("#valor");a.val(c(r)),a.on("keydown",function(e){const t=e.key;return["Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t)?!0:(e.preventDefault(),t==="Backspace"?(r=Math.floor(r/10),a.val(c(r)),d(a),!1):t==="Delete"?(r=0,a.val(c(r)),d(a),!1):(/^[0-9]$/.test(t)&&(r>9999999999||(r=r*10+parseInt(t),a.val(c(r)),d(a))),!1))}),a.on("paste",function(e){e.preventDefault();const o=(e.originalEvent.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"");o&&(r=parseInt(o)||0,r>99999999999&&(r=99999999999),a.val(c(r)),d(a))}),a.on("focus",function(){const e=n(this).val().length;this.setSelectionRange(e,e)}),a.data("getCentavos",function(){return r})}function B(){const a=new Date,e=a.toLocaleDateString("pt-BR");n("#data-display").text(e).removeClass("text-zinc-400").addClass("text-amber-900"),n("#data-input").val(a.toISOString().split("T")[0]),n("#btn-limpar").removeClass("hidden")}function M(){const a=n(this).val().trim(),e=n(this);if(a.length>0){const t=D(a);t.valido?l.marcarValido(e):l.mostrarErro(e,t.mensagem)}}function P(){l.limparErro(n(this))}function R(){const a=n(this).val(),e=n(this);if(a.length>0){const t=L(a);t.valido?l.marcarValido(e):l.mostrarErro(e,t.mensagem)}}function N(){n(this).val()&&l.marcarValido(n(this))}function U(){n("#descricao").on("blur",M),n("#descricao").on("input",P),n("#valor").on("blur",R),n("#categoria").on("change",N)}function j(){n("#form-transacao").addClass("animate-shake"),setTimeout(function(){n("#form-transacao").removeClass("animate-shake")},500)}function Y(a){const e=a.tipo==="receita"?"Receita":"Despesa";m.sucesso("mensagem-feedback",`${e} adicionada com sucesso!`),setTimeout(function(){n("main").addClass("animate-exit"),setTimeout(function(){window.location.href="./todas-transacoes.html"},300)},1e3)}function W(a,e){console.error("Erro ao salvar transação:",a);let t="Erro ao salvar transação. Tente novamente.";a.statusText==="error"&&(t="Erro de conexão. Verifique se o servidor está rodando."),m.erro("mensagem-feedback",t),h.restaurar(e)}async function q(a){const e=z();if(!e.valido){m.erro("mensagem-feedback",e.mensagem),e.campo&&n(e.campo).addClass("input-error").focus(),j();return}const t=n('#form-transacao button[type="submit"]');h.loading(t,"Salvar transação");const o={usuarioId:a,descricao:e.dados.descricao,categoria:e.dados.categoria,valor:e.dados.valor,tipo:e.dados.tipo,data:e.dados.data};try{await n.ajax({url:`${S}/transacoes`,method:"POST",contentType:"application/json",data:JSON.stringify(o),dataType:"json"}),Y(o)}catch(i){W(i,t)}}function G(a,e){a.preventDefault(),q(e)}function H(a){n("#descricao").on("input",u),n("#data-input").on("change",u),n("#form-transacao").on("submit",function(e){G(e,a.id)}),b.configurarLogout()}function J(){const a=C.verificarAutenticacao(!0);a&&(b.atualizarUIUsuario(a),O(),B(),U(),u(),H(a))}n(document).ready(J);
