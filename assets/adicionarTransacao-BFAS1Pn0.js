import{$ as t,A as g}from"./auth-Dh7lbV3Z.js";import{F as u,B as h}from"./button-Dnti6uPe.js";document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("cally-widget"),e=document.getElementById("data-display"),o=document.getElementById("data-input"),n=document.getElementById("btn-limpar");a&&(a.addEventListener("change",r=>{const i=r.target.value;o.value=i;const[l,c,d]=i.split("-");e.textContent=`${d}/${c}/${l}`,e.classList.remove("text-zinc-400"),e.classList.add("text-zinc-950"),n.classList.remove("hidden"),o.dispatchEvent(new Event("change")),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),n.addEventListener("mousedown",r=>{r.preventDefault(),r.stopPropagation()}),n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),a.value="",o.value="",e.textContent="Selecionar data...",e.classList.remove("text-zinc-950"),e.classList.add("text-zinc-400"),n.classList.add("hidden"),o.dispatchEvent(new Event("change"))}))});const D="http://localhost:3001",f={descricao:/^[a-zA-ZÀ-ÿ0-9\s.,!?()-]+$/,valorMonetario:/^\d{1,3}(\.\d{3})*(,\d{2})?$/,dataISO:/^\d{4}-\d{2}-\d{2}$/};let s=0;t(document).ready(function(){const a=g.verificarAutenticacao(!0);if(!a)return;w(),T(),E(),m(),t("#descricao").on("input",m),t("#data-input").on("change",m),t("#form-transacao").on("submit",function(o){o.preventDefault(),$(a.id)});const e=a.nome.split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase();t(".avatar-inicial").text(e),t("#usuario-email").text(a.email),t("#btn-logout").on("click",function(o){o.preventDefault(),t("main").addClass("animate-exit"),setTimeout(function(){g.logout()},300)})});function b(a,e){const o=a.attr("id");let n=t(`#${o}-erro`);n.length||(n=t(`<span id="${o}-erro" class="text-xs text-red-500 mt-1"></span>`),a.closest(".form-control").append(n)),n.text(e).removeClass("hidden"),a.addClass("input-error").removeClass("input-success")}function p(a){const e=a.attr("id");t(`#${e}-erro`).addClass("hidden"),a.removeClass("input-error")}function v(a){p(a),a.addClass("input-success")}function E(){t("#descricao").on("blur",function(){const a=t(this).val().trim(),e=t(this);if(a.length>0){const o=C(a);o.valido?v(e):b(e,o.mensagem)}}),t("#descricao").on("input",function(){p(t(this))}),t("#valor").on("blur",function(){const a=t(this).val(),e=t(this);if(a.length>0){const o=x(a);o.valido?v(e):b(e,o.mensagem)}}),t("#categoria").on("change",function(){const a=t(this).val(),e=t(this);a&&v(e)})}function m(){const a=t("#descricao").val().trim(),e=t("#data-input").val(),o=a.length>=3&&s>0&&e.length>0;t("#btn-submit").prop("disabled",!o)}function w(){const a=t("#valor");a.val(e(s));function e(n){return(n/100).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}a.on("keydown",function(n){const r=n.key;return["Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(r)?!0:(n.preventDefault(),r==="Backspace"?(s=Math.floor(s/10),a.val(e(s)),o(),!1):r==="Delete"?(s=0,a.val(e(s)),o(),!1):(/^[0-9]$/.test(r)&&(s>9999999999||(s=s*10+parseInt(r),a.val(e(s)),o())),!1))}),a.on("paste",function(n){n.preventDefault();const i=(n.originalEvent.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"");i&&(s=parseInt(i)||0,s>99999999999&&(s=99999999999),a.val(e(s)),o())});function o(){p(a),s>0?a.removeClass("input-error").addClass("input-success"):a.removeClass("input-success").removeClass("input-error"),m()}a.on("focus",function(){const n=t(this).val().length;this.setSelectionRange(n,n)}),a.data("getCentavos",function(){return s})}function T(){const a=new Date,e=a.toLocaleDateString("pt-BR");t("#data-display").text(e).removeClass("text-zinc-400").addClass("text-amber-900"),t("#data-input").val(a.toISOString().split("T")[0]),t("#btn-limpar").removeClass("hidden")}function y(a){return a&&parseFloat(a.replace(/\./g,"").replace(",","."))||0}function C(a){return!a||a.trim()===""?{valido:!1,mensagem:"A descrição é obrigatória"}:(a=a.trim(),a.length<3?{valido:!1,mensagem:"A descrição deve ter pelo menos 3 caracteres"}:a.length>100?{valido:!1,mensagem:"A descrição deve ter no máximo 100 caracteres"}:f.descricao.test(a)?{valido:!0,mensagem:""}:{valido:!1,mensagem:"A descrição contém caracteres inválidos"})}function x(a){if(!a||a.trim()==="")return{valido:!1,mensagem:"O valor é obrigatório",valor:0};const e=y(a);return isNaN(e)?{valido:!1,mensagem:"Valor inválido",valor:0}:e<=0?{valido:!1,mensagem:"O valor deve ser maior que zero",valor:0}:e>99999999999e-2?{valido:!1,mensagem:"O valor máximo é R$ 999.999.999,99",valor:0}:a.includes(",")&&!f.valorMonetario.test(a)?{valido:!1,mensagem:"Formato de valor inválido",valor:0}:{valido:!0,mensagem:"",valor:e}}function A(a){if(!a||a.trim()==="")return{valido:!1,mensagem:"Selecione uma data para a transação"};if(!f.dataISO.test(a))return{valido:!1,mensagem:"Formato de data inválido"};const e=new Date(a);if(isNaN(e.getTime()))return{valido:!1,mensagem:"Data inválida"};const o=new Date;if(o.setFullYear(o.getFullYear()+1),e>o)return{valido:!1,mensagem:"A data não pode ser superior a 1 ano no futuro"};const n=new Date;return n.setFullYear(n.getFullYear()-10),e<n?{valido:!1,mensagem:"A data não pode ser superior a 10 anos no passado"}:{valido:!0,mensagem:""}}function L(a){if(!a)return{valido:!1,mensagem:"Selecione o tipo da transação"};const e=a.toLowerCase();return e!=="receita"&&e!=="despesa"?{valido:!1,mensagem:"Tipo de transação inválido"}:{valido:!0,mensagem:""}}function I(){const a=t("#descricao").val().trim(),e=t("#valor").val(),o=t("#data-input").val(),n=t('input[name="tipo"]:checked').attr("aria-label"),r=t("#categoria").val()||"Outros";t(".input, .select").removeClass("input-error").removeClass("input-success"),u.limpar("mensagem-feedback");const i=C(a);if(!i.valido)return{valido:!1,mensagem:i.mensagem,campo:"#descricao"};const l=x(e);if(!l.valido)return{valido:!1,mensagem:l.mensagem,campo:"#valor"};const c=A(o);if(!c.valido)return{valido:!1,mensagem:c.mensagem,campo:null};const d=L(n);return d.valido?{valido:!0,mensagem:"",dados:{descricao:a,valor:l.valor,data:o,tipo:n.toLowerCase(),categoria:r}}:{valido:!1,mensagem:d.mensagem,campo:null}}function $(a){const e=I();if(!e.valido){u.erro("mensagem-feedback",e.mensagem),e.campo&&t(e.campo).addClass("input-error").focus(),t("#form-transacao").addClass("animate-shake"),setTimeout(function(){t("#form-transacao").removeClass("animate-shake")},500);return}const o=t('#form-transacao button[type="submit"]');h.loading(o,"Salvar transação");const n={usuarioId:a,descricao:e.dados.descricao,categoria:e.dados.categoria,valor:e.dados.valor,tipo:e.dados.tipo,data:e.dados.data};t.ajax({url:`${D}/transacoes`,method:"POST",contentType:"application/json",data:JSON.stringify(n),dataType:"json"}).then(function(){const r=n.tipo==="receita"?"Receita":"Despesa";u.sucesso("mensagem-feedback",`${r} adicionada com sucesso!`),setTimeout(function(){t("main").addClass("animate-exit"),setTimeout(function(){window.location.href="./todas-transacoes.html"},300)},1e3)}).catch(function(r){console.error("Erro ao salvar transação:",r);let i="Erro ao salvar transação. Tente novamente.";r.statusText==="error"&&(i="Erro de conexão. Verifique se o servidor está rodando."),u.erro("mensagem-feedback",i),h.restaurar(o)})}
